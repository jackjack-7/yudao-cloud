<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.iocoder.yudao.module.system.dal.mysql.user.AdminUserMapper">

    <select id="selectPageWithRoles"
            resultMap="userRoleMap">
        SELECT * FROM system_users AS u INNER JOIN system_user_role AS ur ON u.id = ur.user_id
        <where>
            <if test="u.dept_id != null">
                u.dept_id IN
                <foreach collection="deptIds" item="dept_id" separator="," open="(" close=")">
                    #{dept_id}
                </foreach>
            </if>
            <if test="reqVO.username != null and reqVO.username !=''">
                AND u.username LIKE CONCAT('%',#{reqVO.username},'%')
            </if>
            <if test="reqVO.createTime != null">
                AND u.create_time BETWEEN #{reqVO.createTime[0]}, #{reqVO.createTime[1]},
            </if>
            <if test="reqVO.status != null">
                AND u.status = #{reqVO.status}
            </if>
            <if test="reqVO.roleName != null">
                AND ur.name = #{reqVO.roleName}
            </if>
        </where>
        ORDER BY u.id DESC
    </select>

    <resultMap id="userRoleMap" type="cn.iocoder.yudao.module.system.dal.dto.AdminUserDTO">
        <id column="u.id" property="id" />
        <result column="u.username" property="username" />
        <result column="u.status" property="status" />
        <result column="u.create_time" property="createTime" />
<!--        <collection property="roles" ofType="UserRoleDO">-->
<!--            <id column="ur.id" property="id" />-->
<!--            <result column="ur.name" property="name" />-->
<!--        </collection>-->
    </resultMap>

</mapper>
